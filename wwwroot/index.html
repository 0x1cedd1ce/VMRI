<html>

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Virtual MRI</title>
    <base href="./" />
    <script src="./geotiff.js"></script>
    <script src="compiled/a.out.js"></script>
    <script src="kissfft.js"></script>
    <script src="./vmri.js"></script>
    <link rel="stylesheet" href="custom.css" />
</head>

<body class="text-monospace">
    <div class="main">
        <div class="top-row px-4">
            <input type="button" class="btn-primary oi-data-transfer-download" onclick="loadFuzzyDataSet()" value="Load Dataset" id="loadDataset" />
            <div class="ml-2 spinner-border hidden" role="status" id="datasetLoading">
                <span class="sr-only">Loading...</span>
            </div>
            <div class="flex-fill"></div>
            <h1>Virtual MRI</h1>
        </div>
        <div class="content px-4 pt-2 hidden" id="content">
            <div class="row">
                <figure class="col pr-0 figure text-center">
                    <figcaption class="figure-caption">Proton density</figcaption>
                    <canvas class="figure-img img-fluid rounded" id="imgPD"></canvas>
                </figure>
                <figure class="col pl-0 pr-0 figure text-center">
                    <figcaption class="figure-caption">T1 time</figcaption>
                    <canvas class="figure-img img-fluid rounded" id="imgT1"></canvas>
                </figure>
                <figure class="col pl-0 figure text-center">
                    <figcaption class="figure-caption">T2 time</figcaption>
                    <canvas class="figure-img img-fluid rounded" id="imgT2"></canvas>
                </figure>
            </div>
            <div class="row mx-1">
                <div class="col-auto">
                    <label class="mb-0 py-1 align-self-center" for="slice">Slice:</label>
                </div>
                <div class="col">
                <input type="range" class="pl-0 pr-0 align-self-center form-control form-control-range" min="0" max="zdim" name="slice" id="slice" value="100" onchange="displayDataSet();" />
                </div>
            </div>

            <div class="card-deck my-2">
                <div class="card">
                    <div class="card-body">
                        <div class="card-title">Inversion Recovery</div>
                        <div class="row border py-2 mx-2">
                            <div class="col">
                                <div class="form-row">
                                    <div class="col-auto w-25">
                                        <label class="mb-0 align-self-center">TI:</label>
                                    </div>
                                    <input class="col-sm form-control" type="number" value="400" name="ir_ti" id="ir_ti" />
                                </div>
                                <div class="form-row">
                                    <div class="col-auto w-25">
                                        <label class="mb-0 align-self-center">TR:</label>
                                    </div>
                                    <input class="col-sm form-control" type="number" value="6000" name="ir_tr" id="ir_tr" />
                                </div>
                            </div>
                        </div>
                        <div class="row mx-2">
                            <input type="button" class="col btn-primary" onclick="inversionRecovery()" value="Start Scan" />
                        </div>
                        <div class="row pb-2 pt-3 hidden" id="inversionRecoveryLoading">
                            <div class="flex-fill"></div>
                            <div class="spinner-border" role="status">
                                <span class="sr-only">Loading...</span>
                            </div>
                            <div class="flex-fill"></div>
                        </div>

                        <div class="row pt-3 hidden" id="ir_result">
                            <div class="col-auto">
                                <label for="ti">Window Center: </label>
                                <input type="range" class="pl-0 pr-0 form-control form-control-range" name="wc" id="ir_wc" min="0" max="4096" value="2048" onchange="displayAndWindow3DImage(document.getElementById('ir_result'), inversionRecoveryResult);" />

                                <label for="tr">Window Width:</label>
                                <input type="range" class="pl-0 pr-0 form-control form-control-range" name="ww" id="ir_ww" min="0" max="4096" value="4096" onchange="displayAndWindow3DImage(document.getElementById('ir_result'), inversionRecoveryResult);" />

                                <label for="slice">Slice:</label>
                                <input type="range" class="pl-0 pr-0 form-control form-control-range" min="0" max="zdim" name="slice" id="ir_slice" value="100" onchange="displayAndWindow3DImage(document.getElementById('ir_result'), inversionRecoveryResult);" />
                            </div>

                            <canvas class="border col mx-2 p-0 img-fluid" id="ir_imgResult"></canvas>

                            <canvas class="border col mx-2 p-0 img-fluid" id="se_kResult"></canvas>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-body">
                        <div class="card-title">Spin Echo</div>
                        <div class="row border py-2 mx-2">
                            <div class="col">
                                <div class="form-row">
                                    <div class="col-auto w-25">
                                        <label class="mb-0 align-self-center">TE:</label>
                                    </div>
                                    <input class="col-sm form-control" type="number" value="400" name="se_te" id="se_te" />
                                </div>
                                <div class="form-row">
                                    <div class="col-auto w-25">
                                        <label class="mb-0 align-self-center">TR:</label>
                                    </div>
                                    <input class="col-sm form-control" type="number" value="6000" name="se_tr" id="se_tr" />
                                </div>
                            </div>
                        </div>
                        <div class="row mx-2">
                            <input type="button" class="col btn-primary" onclick="spinEcho()" value="Start Scan" />
                        </div>
                        <div class="row pb-2 pt-3 hidden" id="spinEchoLoading">
                            <div class="flex-fill"></div>
                            <div class="spinner-border" role="status">
                                <span class="sr-only">Loading...</span>
                            </div>
                            <div class="flex-fill"></div>
                        </div>

                        <div class="row pt-3 hidden" id="se_result">
                            <div class="col-auto">
                                <label for="ti">Window Center: </label>
                                <input type="range" class="pl-0 pr-0 form-control form-control-range" name="wc" id="se_wc" min="0" max="4096" value="2048" onchange="displayAndWindow3DImage(document.getElementById('se_result'), spinEchoResult);" />

                                <label for="tr">Window Width:</label>
                                <input type="range" class="pl-0 pr-0 form-control form-control-range" name="ww" id="se_ww" min="0" max="4096" value="4096" onchange="displayAndWindow3DImage(document.getElementById('se_result'), spinEchoResult);" />

                                <label for="slice">Slice:</label>
                                <input type="range" class="pl-0 pr-0 form-control form-control-range" min="0" max="zdim" name="slice" id="se_slice" value="0" onchange="displayAndWindow3DImage(document.getElementById('se_result'), spinEchoResult);" />
                            </div>

                            <canvas class="border col mx-2 p-0 img-fluid" id="se_imgResult"></canvas>

                            <canvas class="border col mx-2 p-0 img-fluid" id="se_kResult"></canvas>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>
</body>

</html>